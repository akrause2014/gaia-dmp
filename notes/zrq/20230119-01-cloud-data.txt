#
# <meta:header>
#   <meta:licence>
#     Copyright (c) 2022, ROE (http://www.roe.ac.uk/)
#
#     This information is free software: you can redistribute it and/or modify
#     it under the terms of the GNU General Public License as published by
#     the Free Software Foundation, either version 3 of the License, or
#     (at your option) any later version.
#
#     This information is distributed in the hope that it will be useful,
#     but WITHOUT ANY WARRANTY; without even the implied warranty of
#     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#     GNU General Public License for more details.
#
#     You should have received a copy of the GNU General Public License
#     along with this program.  If not, see <http://www.gnu.org/licenses/>.
#   </meta:licence>
# </meta:header>
#
#zrq-notes-time
#zrq-notes-indent
#zrq-notes-crypto
#zrq-notes-ansible
#zrq-notes-osformat
#zrq-notes-zeppelin
#

    Target:

        Follow up from grid-support

    Result:

        Work in progress ...

# -----------------------------------------------------

    Hi Dave,
    We've done some testing on this. We've found that adding the option `public_url_use_https = True` to the `.s3cfg` for s3cmd has made it return them as https. Here is the bucket we used -

        [root@ceph-adm1 ~]# s3cmd info s3://aidan-public-bucket-test-4
        s3://aidan-public-bucket-test-4/ (bucket):
           Location:  us-east-1
           Payer:     BucketOwner
           Expiration Rule: none
           Policy:    none
           CORS:      none
           ACL:       *anon*: READ
           ACL:       dteam: FULL_CONTROL
           URL:       https://s3.echo.stfc.ac.uk/aidan-public-bucket-test-4/

        [root@ceph-adm1 ~]# curl --verbose https://s3.echo.stfc.ac.uk/aidan-public-bucket-test-4/
        * About to connect() to s3.echo.stfc.ac.uk port 443 (#0)
        *   Trying 130.246.176.245...
        * Connected to s3.echo.stfc.ac.uk (130.246.176.245) port 443 (#0)
        ...

    We don't believe anything has changed on our end, we got to this result by changing our s3cmd config.

    Hopefully this helps, let me know if you need anything else.

# -----------------------------------------------------

    Turns out the public URL is generated by the client, not the sever, and the S3cmd client has 'http' as a hard coded default.

    s3cmd client is hard coded to use HTTP
    https://github.com/s3tools/s3cmd/issues/551

    There is an option to use https for the public URLs that it generates.
    https://github.com/s3tools/s3cmd/blob/master/S3/S3Uri.py#L91-L98

    .. but the client user needs to know that they need to select that option.



